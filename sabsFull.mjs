var text = `<population desc="population written from streaming">



<!-- ====================================================================== -->

	<person id="person_1">
		<attributes>
			<attribute name="age" class="java.lang.String">67</attribute>
			<attribute name="caravail" class="java.lang.String">1</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">79344</attribute>
			<attribute name="householdincome" class="java.lang.String">10</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">m</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">1</attribute>
			<attribute name="wards" class="java.lang.String">19100032</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490940.400081746" y="-3718593.40331236" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_19">
		<attributes>
			<attribute name="age" class="java.lang.String">21</attribute>
			<attribute name="caravail" class="java.lang.String">0</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">1</attribute>
			<attribute name="household" class="java.lang.String">90294</attribute>
			<attribute name="householdincome" class="java.lang.String">1</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">m</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100104</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490757.003784395" y="-3718641.19752418" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_34">
		<attributes>
			<attribute name="age" class="java.lang.String">59</attribute>
			<attribute name="caravail" class="java.lang.String">1</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">1</attribute>
			<attribute name="household" class="java.lang.String">43734</attribute>
			<attribute name="householdincome" class="java.lang.String">6</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">m</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100114</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-491086.62739541" y="-3718986.38532806" end_time="10:31:43" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="leisure" x="-513373.333655111" y="-3714721.00775976" end_time="16:00:20" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="home" x="-491086.62739541" y="-3718986.38532806" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_39">
		<attributes>
			<attribute name="age" class="java.lang.String">25</attribute>
			<attribute name="caravail" class="java.lang.String">1</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">0</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">58970</attribute>
			<attribute name="householdincome" class="java.lang.String">7</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">m</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100033</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490769.058627955" y="-3719048.20406471" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_45">
		<attributes>
			<attribute name="age" class="java.lang.String">26</attribute>
			<attribute name="caravail" class="java.lang.String">1</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">TRUE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">1</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">13683</attribute>
			<attribute name="householdincome" class="java.lang.String">10</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">f</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100113</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490973.119252905" y="-3718960.47089751" end_time="06:16:08" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="work" x="-506627.16208885" y="-3712224.17588777" end_time="12:11:42" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="leisure" x="-480610.817234819" y="-3729660.88125859" end_time="15:00:07" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="other" x="-479268.541297951" y="-3725671.41640483" end_time="17:11:07" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="home" x="-490973.119252905" y="-3718960.47089751" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_47">
		<attributes>
			<attribute name="age" class="java.lang.String">47</attribute>
			<attribute name="caravail" class="java.lang.String">1</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">TRUE</attribute>
			<attribute name="haslicense" class="java.lang.String">0</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">13460</attribute>
			<attribute name="householdincome" class="java.lang.String">8</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">f</attribute>
			<attribute name="smoker" class="java.lang.String">1</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100060</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490973.119252905" y="-3718960.47089751" end_time="06:38:42" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="work" x="-517407.717516835" y="-3735165.8579208" end_time="15:29:42" >
			</activity>
			<leg mode="car">
			</leg>
			<activity type="home" x="-490973.119252905" y="-3718960.47089751" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_52">
		<attributes>
			<attribute name="age" class="java.lang.String">1</attribute>
			<attribute name="caravail" class="java.lang.String">0</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">41147</attribute>
			<attribute name="householdincome" class="java.lang.String">1</attribute>
			<attribute name="race" class="java.lang.String">1</attribute>
			<attribute name="sex" class="java.lang.String">m</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">TRUE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100042</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-505612.48700627" y="-3715285.72174564" end_time="05:36:06" >
			</activity>
			<leg mode="walk">
			</leg>
			<activity type="education" x="-505625.476135581" y="-3715324.26352754" end_time="12:30:07" >
			</activity>
			<leg mode="walk">
			</leg>
			<activity type="home" x="-505612.48700627" y="-3715285.72174564" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_54">
		<attributes>
			<attribute name="age" class="java.lang.String">27</attribute>
			<attribute name="caravail" class="java.lang.String">1</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">TRUE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">1277</attribute>
			<attribute name="householdincome" class="java.lang.String">10</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">f</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">FALSE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100010</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490934.779785037" y="-3718465.88738838" end_time="07:25:11" >
			</activity>
			<leg mode="pt">
			</leg>
			<activity type="work" x="-497920.444903246" y="-3716255.41518081" end_time="16:32:07" >
			</activity>
			<leg mode="pt">
			</leg>
			<activity type="home" x="-490934.779785037" y="-3718465.88738838" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_80">
		<attributes>
			<attribute name="age" class="java.lang.String">8</attribute>
			<attribute name="caravail" class="java.lang.String">0</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">61710</attribute>
			<attribute name="householdincome" class="java.lang.String">7</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">f</attribute>
			<attribute name="smoker" class="java.lang.String">1</attribute>
			<attribute name="student" class="java.lang.String">TRUE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100084</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-490891.371972787" y="-3718677.51175509" end_time="06:02:52" >
			</activity>
			<leg mode="pt">
			</leg>
			<activity type="education" x="-500157.196341849" y="-3724140.14424523" end_time="12:28:48" >
			</activity>
			<leg mode="pt">
			</leg>
			<activity type="shopping" x="-494896.786356886" y="-3702259.14716696" end_time="13:41:10" >
			</activity>
			<leg mode="pt">
			</leg>
			<activity type="home" x="-490891.371972787" y="-3718677.51175509" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

	<person id="person_100">
		<attributes>
			<attribute name="age" class="java.lang.String">17</attribute>
			<attribute name="caravail" class="java.lang.String">0</attribute>
			<attribute name="const" class="java.lang.String">1</attribute>
			<attribute name="employed" class="java.lang.String">FALSE</attribute>
			<attribute name="haslicense" class="java.lang.String">1</attribute>
			<attribute name="hivcured" class="java.lang.String">0</attribute>
			<attribute name="hivuncured" class="java.lang.String">0</attribute>
			<attribute name="household" class="java.lang.String">100221</attribute>
			<attribute name="householdincome" class="java.lang.String">7</attribute>
			<attribute name="race" class="java.lang.String">0</attribute>
			<attribute name="sex" class="java.lang.String">f</attribute>
			<attribute name="smoker" class="java.lang.String">0</attribute>
			<attribute name="student" class="java.lang.String">TRUE</attribute>
			<attribute name="subpopulation" class="java.lang.String">person</attribute>
			<attribute name="tbc" class="java.lang.String">0</attribute>
			<attribute name="wards" class="java.lang.String">19100069</attribute>
		</attributes>
		<plan selected="yes">
			<activity type="home" x="-491034.06650245" y="-3718865.07979688" end_time="07:29:43" >
			</activity>
			<leg mode="walk">
			</leg>
			<activity type="education" x="-491167.01582742" y="-3718233.74927288" end_time="13:47:07" >
			</activity>
			<leg mode="walk">
			</leg>
			<activity type="shopping" x="-491678.411085163" y="-3718482.40650569" end_time="14:57:53" >
			</activity>
			<leg mode="walk">
			</leg>
			<activity type="home" x="-491034.06650245" y="-3718865.07979688" >
			</activity>
		</plan>

	</person>

<!-- ====================================================================== -->

</population>`

import { JSDOM } from "jsdom";
import { writeFileSync } from "fs";

const dom = new JSDOM(text);
var xmlDoc = dom.window.document;

// totals to be removed for each activity type
var educationActivitiesToDelete = 12892;
var shoppingActivitiesToDelete = 2952;
var leisureActivitiesToDelete = 5612;
var workActivitiesToDelete = 9165;

// totals to be removed for each transport type
var walkingActivitiesToDelete = 12392;
var carActivitiesToDelete = 13883;
var publicTransportActivitiesToDelete = 30531;

// iterate over all persons
var persons = xmlDoc.getElementsByTagName("person");
const personsArray = Array.from(persons);
console.log(personsArray.length)
for (let i = 0; i < personsArray.length; i++) {

	var person = personsArray[i];

	// temp totals to be removed for each activity type
	var eduActivitiesForPerson = 0;
	var shopActivitiesForPerson = 0;
	var leisActivitiesForPerson = 0;
	var worActivitiesForPerson = 0;

	// temp totals to be removed for each transport type
	var walkActivitiesForPerson = 0;
	var caActivitiesForPerson = 0;
	var pubActivitiesForPerson = 0;

	// get plan
	var plan = person.getElementsByTagName("plan")[0];

	// iterate over all activities
	var activities = plan.getElementsByTagName("activity");
	for (let j = 0; j < activities.length; j++) {
		var activity = activities[j];
		switch (activity.getAttribute("type")) {
			case "leisure":
				leisActivitiesForPerson++;
				break;

			case "shopping":
				shopActivitiesForPerson++;
				break;

			case "education":
				eduActivitiesForPerson++;
				break;

			case "work":
				worActivitiesForPerson++;
				break;

			case "other":
				leisActivitiesForPerson++;
				break;

			default:
				break;
		}
	}

	// iterate over all legs
	var legs = plan.getElementsByTagName("leg");
	for (let j = 0; j < legs.length; j++) {
		var leg = legs[j];
		switch (leg.getAttribute("mode")) {
			case "walk":
				walkActivitiesForPerson++;
				break;

			case "car":
				caActivitiesForPerson++;
				break;

			case "pt":
				pubActivitiesForPerson++;
				break;

			default:
				break;
		}
	}
	if(
		(eduActivitiesForPerson < educationActivitiesToDelete && eduActivitiesForPerson != 0 )
		|| ( shopActivitiesForPerson < shoppingActivitiesToDelete && shopActivitiesForPerson != 0)
		|| (leisActivitiesForPerson < leisureActivitiesToDelete && leisActivitiesForPerson != 0)
		|| (worActivitiesForPerson < workActivitiesToDelete && worActivitiesForPerson != 0)
		|| (walkActivitiesForPerson < walkingActivitiesToDelete && walkActivitiesForPerson != 0)
		|| (caActivitiesForPerson < carActivitiesToDelete && caActivitiesForPerson != 0)
		|| (pubActivitiesForPerson < publicTransportActivitiesToDelete && pubActivitiesForPerson != 0)
		) {
		// remove person from xmlDoc
		person.parentNode.removeChild(person);
		console.log("");
		console.log("removed person " + person.getAttribute("id") + " (" + i + ")");
		
		if (eduActivitiesForPerson != 0){
			console.log(eduActivitiesForPerson + " educationActivitiesToDelete removed");
			console.log(educationActivitiesToDelete - eduActivitiesForPerson + "education Activities still need to be removed");
		}
		if (shopActivitiesForPerson != 0){
			console.log(shopActivitiesForPerson + " shoppingActivitiesToDelete removed");
			console.log(shoppingActivitiesToDelete - shopActivitiesForPerson + " shopping ActivitiesToDelete still need to be removed");
		}
		if (leisActivitiesForPerson != 0){
			console.log(leisActivitiesForPerson + " leisureActivitiesToDelete removed");
			console.log(leisureActivitiesToDelete - leisActivitiesForPerson + " leisureActivitiesToDelete still need to be removed");
		}
		if (worActivitiesForPerson != 0){
			console.log(worActivitiesForPerson + " workActivitiesToDelete removed");
			console.log(workActivitiesToDelete - worActivitiesForPerson + " workActivitiesToDelete still need to be removed");
		}
		if (walkActivitiesForPerson != 0){
			console.log(walkActivitiesForPerson + " walkingActivitiesToDelete removed");
			console.log(walkingActivitiesToDelete - walkActivitiesForPerson + " walkingActivitiesToDelete still need to be removed");
		}
		if (caActivitiesForPerson != 0){
			console.log(caActivitiesForPerson + " carActivitiesToDelete removed");
			console.log(carActivitiesToDelete - caActivitiesForPerson + " carActivitiesToDelete still need to be removed");
		}
		if (pubActivitiesForPerson != 0){
			console.log(pubActivitiesForPerson + " publicTransportActivitiesToDelete removed");
			console.log(publicTransportActivitiesToDelete - pubActivitiesForPerson + " publicTransportActivitiesToDelete still need to be removed");
		}
		
		// decrement total
		educationActivitiesToDelete -= eduActivitiesForPerson;
		shoppingActivitiesToDelete -= shopActivitiesForPerson;
		leisureActivitiesToDelete -= leisActivitiesForPerson;	
		workActivitiesToDelete -= worActivitiesForPerson;
		walkingActivitiesToDelete -= walkActivitiesForPerson;
		carActivitiesToDelete -= caActivitiesForPerson;
		publicTransportActivitiesToDelete -= pubActivitiesForPerson;
	}
	else{
		console.log("");
		console.log("not removed person " + person.getAttribute("id") + " (" + i + ")");
	}
	
	if (educationActivitiesToDelete == 0 && shoppingActivitiesToDelete == 0  && leisureActivitiesToDelete == 0 && workActivitiesToDelete == 0 && walkingActivitiesToDelete == 0 && carActivitiesToDelete == 0 && publicTransportActivitiesToDelete == 0){
		break;
	}
}

writeFileSync("test.xml", xmlDoc.documentElement.outerHTML);